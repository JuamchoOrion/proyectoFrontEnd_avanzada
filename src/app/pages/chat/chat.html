<div class="chat-wrapper container py-4">
  <div class="chat-box shadow-lg">
    <div class="row g-0">
      <!-- CONTACTOS -->
      <div class="col-md-4 contacts-panel">
        <h4 class="section-title">ðŸ’¬ Chats</h4>

        <!-- Nuevo chat -->
        <form (ngSubmit)="startNewChat()" class="new-chat-form mt-3">
          <input
            class="input-modern"
            placeholder="Correo del usuario"
            [(ngModel)]="newEmail"
            name="email"
          />
          <input
            class="input-modern mt-2"
            placeholder="Primer mensaje"
            [(ngModel)]="firstMessage"
            name="firstMsg"
          />
          <button class="btn btn-success w-100 mt-2">Iniciar chat</button>
        </form>

        <!-- Lista de contactos -->
        <ul class="contact-list mt-4">
          <li
            *ngFor="let c of contacts; trackBy: trackByContactId"
            (click)="openChat(c)"
            class="contact-item"
          >
            <img
              [src]="
                c.photoUrl ||
                'https://res.cloudinary.com/dbeyylkba/image/upload/v1762801754/307ce493-b254-4b2d-8ba4-d12c080d6651_w7ozqw.jpg'
              "
              class="contact-avatar"
            />

            <div>
              <strong>{{ getContactDisplayName(c) }}</strong>
              <br />
              <small class="text-muted">{{ c.email }}</small>
            </div>
          </li>
        </ul>
      </div>

      <!-- CHAT -->
      <div class="col-md-8 chat-panel">
        <div *ngIf="!selectedContact" class="empty-chat">
          <p>Selecciona un contacto para comenzar ðŸ˜Š</p>
        </div>

        <div *ngIf="selectedContact" class="d-flex flex-column h-100">
          <!-- HEADER -->
          <div class="chat-header">
            <img
              [src]="
                selectedContact.photoUrl ||
                'https://res.cloudinary.com/dbeyylkba/image/upload/v1762801754/307ce493-b254-4b2d-8ba4-d12c080d6651_w7ozqw.jpg'
              "
              class="chat-header-avatar"
            />
            <div>
              <strong class="chat-header-name">{{ selectedContact.username }}</strong>
              <br />
              <small class="text-muted">{{ selectedContact.email }}</small>
            </div>
          </div>

          <!-- MENSAJES -->
          <div class="messages-area" #scrollMe>
            <div *ngFor="let m of messages" class="message-row" [class.me]="m.senderId === me.id">
              <div class="message-bubble">
                {{ m.content }}
                <div class="message-time">{{ m.timestamp | date : 'shortTime' }}</div>
              </div>
            </div>
          </div>

          <!-- INPUT -->
          <form (ngSubmit)="send()" class="message-input-area">
            <input
              [(ngModel)]="newMessage"
              name="msg"
              class="message-input"
              placeholder="Escribe un mensaje..."
            />
            <button class="btn btn-primary send-btn">Enviar</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
<app-footer></app-footer>
